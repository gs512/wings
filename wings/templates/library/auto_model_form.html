{% extends "base.html" %}
{% load staticfiles %}
{% block title %}
<ul class="nav nav-pills nav-left">
<li><a href="#" class="no_link"><strong><i class="glyphicon glyphicon-dashboard"></i>{{ form.instance.get_meta_name }}</strong></a></li>
</ul>
<hr>
{% endblock %}
{% block content %}
<form method="post" role="form" class="form-horizontal">
	{% csrf_token %}


{% for field in form %}

        {% if field.errors %} <div class="form-group has-error">
        {% else %}
        <div class="form-group">
				{% endif %}
            <label class="control-label" for="{{ field.auto_id }}">{{ field.label|capfirst }} : {{field.errors|striptags}} </label>
            {{ field }}

        </div>
{% endfor %}
{% if formset%}<div class="formset">
	
	{{ formset.management_form }}
		{% for form in formset %}
		 {% if form.errors %} <div class="form-group has-error">{% else %}<div class="form-group">{% endif %}
			{% for hidden in form.hidden_fields %}
				{{ hidden }}
			{% endfor %}
			{% for field in form.visible_fields %}
				<label class="control-label" for="{{ field.auto_id }}">{{ field.label }} : {{field.errors|striptags}} </label>
			{{ field }}
			{% endfor %}
			</div>
		{% endfor %}

	
</div>{%endif%}


  <input type="submit" value="Submit" class="btn btn-default"/>
</form>

{% if form_file %}
Attachments :
	<script src="{% static 'main/js/dropzone.js' %}"></script>


		<script type="text/javascript">
			Dropzone.options.myDropzone = {

				// Prevents Dropzone from uploading dropped files immediately
				autoProcessQueue : false,

				init : function() {
					var submitButton = document.querySelector("#submit-all")
					myDropzone = this;

					submitButton.addEventListener("click", function() {
						myDropzone.processQueue();
						// Tell Dropzone to process all queued files.
					});

					// You might want to show the submit button only when
					// files are dropped here:
					this.on("addedfile", function() {
						// Show submit button here and/or inform user to click it.
					});

				}
			};
		</script>
		<link href="{% static 'main/css/dropzone.css' %}" type="text/css" rel="stylesheet"/>
		<!-- IMPORTANT enctype attribute! -->
		<form class="dropzone" action="{% url "drop" %}" method="post" enctype="multipart/form-data">
			{% csrf_token %}
		</form>
		<button id="submit-all">
			Submit all files
		</button>

{%endif%}


{% endblock %}

{% block js %}
	$("form div label").addClass("control-label ");
	$("form div input").addClass("form-control");
	$("form div textarea").addClass("form-control");
	$("form div select").addClass("form-control");
	$("#id_run_config").html('')
	$("#id_run_machine_config").html('')
	
	$('#id_run_location').change(function(e){
		if(parseInt($('#id_run_location').val())>0){
		$("#id_run_config").html('')
		$("#id_run_machine_config").html('<option selected="selected" value="">---------</option>')
		
			$.getJSON('/library/api/rest/sequencer/location/'+$("#id_run_location").val()+'/?username=gs&api_key=618c2eb1850a0ab95316c0a7f7f681e3c6108574',function(data){
					$.each(data,function(key,val){
						$("#id_run_machine_config").append($("<option />").val(data[key]['id']).text(data[key]['name']));
					});
			});
		}
	});
	$('#id_run_machine_config').change(function(e){
		
		if(parseInt($('#id_run_machine_config').val())>0){
		$("#id_run_config").html('')
			$.getJSON('/library/api/rest/sequencer/'+$("#id_run_machine_config").val()+'/runtypes/?username=gs&api_key=618c2eb1850a0ab95316c0a7f7f681e3c6108574',function(data){
					$.each(data,function(key,val){
						$("#id_run_config").append($("<option />").val(data[key]['id']).text(data[key]['name']));
					});
			});
		}
		else{
		$("#id_run_config").html('<option selected="selected" value="">---------</option>')
		
		}
	});
	$("div.formset .form-group").formset();
	
{% endblock %}
